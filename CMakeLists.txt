# $Id$
CMAKE_MINIMUM_REQUIRED(VERSION 2.8.6)
IF( COMMAND CMAKE_POLICY )
  CMAKE_POLICY( SET CMP0003 NEW )
ENDIF()

SET(CMAKE_AUTOMOC TRUE)

PROJECT( elogbook )
SET( ELOGBOOK_VERSION_MAJOR 1 )
SET( ELOGBOOK_VERSION_MINOR 9 )
SET( ELOGBOOK_VERSION_PATCH 6 )
SET( ELOGBOOK_VERSION ${ELOGBOOK_VERSION_MAJOR}.${ELOGBOOK_VERSION_MINOR}.${ELOGBOOK_VERSION_PATCH} )

########### modules #################
SET( CMAKE_MODULE_PATH "${PROJECT_SOURCE_DIR}/base-cmake" )
INCLUDE( Macros )

########### timestamp #########
GET_BUILD_TIMESTAMP( TIMESTAMP )

########### packages ###############
SET( CPACK_PACKAGE_NAME "elogbook" )
SET( CPACK_PACKAGE_VENDOR "hugo.pereira@free.fr" )
SET( CPACK_PACKAGE_VERSION "${ELOGBOOK_VERSION}" )
SET( CPACK_SOURCE_GENERATOR TGZ )
SET( CPACK_SOURCE_PACKAGE_FILE_NAME "${CPACK_PACKAGE_NAME}-${CPACK_PACKAGE_VERSION}" )
INCLUDE( CPack )

########### configuration files ###############
CONFIGURE_FILE( elogbook.spec.cmake ${CMAKE_SOURCE_DIR}/elogbook.spec )

########### external applications ###############
FIND_PROGRAM( FIREFOX firefox )
FIND_PROGRAM( QEDIT qedit )
FIND_PROGRAM( OKULAR okular )
FIND_PROGRAM( GWENVIEW gwenview )

########### aspell ###############
FIND_PROGRAM( ASPELL aspell )
FIND_PACKAGE( ASPELL )
ADD_DEFINITIONS( -DWITH_ASPELL=${ASPELL_FOUND} )

########### subdirectories ###############
IF( ENABLE_SHARED )

  SET(CMAKE_INSTALL_RPATH_USE_LINK_PATH TRUE)
  LINK_DIRECTORIES( ${CMAKE_INSTALL_PREFIX}/lib )

ELSE()

  ADD_SUBDIRECTORY( base )
  ADD_SUBDIRECTORY( base-qt )
  ADD_SUBDIRECTORY( base-server )
  ADD_SUBDIRECTORY( base-help )

  IF( ASPELL_FOUND )
    ADD_SUBDIRECTORY( base-spellcheck )
  ENDIF( ASPELL_FOUND )

ENDIF()

ADD_SUBDIRECTORY( src )
